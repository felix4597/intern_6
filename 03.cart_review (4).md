# 장바구니 페이지 리뷰

## 고객사 요구사항
> 이메일에 작성된 요구 사항 외에 피그마 시안에 있는 세부적인 요구사항을 추가해주시면 됩니다.

## 요구사항에 따른 기능 동작 확인

> ... 세부적인 기능을 추가로 작성해주세요.

## 컴포넌트 구조 (실제 코드 기반 상세)

### 라우팅 및 전역 흐름
- **`src/App.tsx`**
  - 라우트 구성:
- `/`
- `/cart`
- `/payment`
- `/products/:id`
  - 전역 장바구니 상태: `useCartStorage` 훅으로 `localStorage`(`cartItems`)와 동기화
  - `handleAddToCart(product)` 로 장바구니에 추가 (동일 상품은 수량 +1)
  - 헤더에 `cartCount` 배지 전달

- **전역 타입/유틸**
  - `src/types.ts`: `CartItem` 인터페이스, `formatCurrency` 포맷터
  - `src/hooks/useCartStorage.ts`: 장바구니 상태의 영속화(로컬 스토리지) 및 초기 검증/정규화

---

### 페이지( Pages )
- **`src/pages/ProductListPage.tsx`**
  - 데이터: `src/data/products.ts`
  - 렌더: 여러 개의 `ProductCard`를 그리드로 표시
  - 이벤트: `onAddToCart(product)`를 각 카드에 전달하여 담기 처리

- **`src/pages/ProductDetailPage.tsx`**
  - 라우트 파라미터 `:id` 로 상품 조회
  - 상세 정보(이름/설명/가격)와 “장바구니에 담기” 버튼 표시

- **`src/pages/CartPage.tsx`**
  - Prop: `cartItems`, `setCartItems`
  - 내부 상태: `selectedIds: Set<number>`(선택 삭제/선택 결제)
  - 액션:
    - 수량 증가/감소/직접입력(최소 1, 최대 9999, 숫자 이외 제거)
    - 개별 삭제/선택 삭제(확인창)
    - **전체 선택/해제**
    - **뒤로가기**: `navigate(-1)`
    - **결제 이동**: 선택된 항목(없으면 전체)을 `navigate("/payment", { state })` 로 전달
  - 금액 계산(`useMemo`):
    - 총 상품 금액, 배송비, 최종 결제 금액
    - 무료배송까지 남은 금액 문구
  - UI 구성:
    - 좌측: 장바구니 목록(썸네일, 이름, 옵션, 수량 조절, 개별 삭제)
    - 우측: 요약(총 금액/배송비/최종 금액) + “결제하기” 버튼(선택 항목 없으면 비활성)

- **`src/pages/PaymentPage.tsx`**
  - 결제 수단 저장소: `localStorage("payment_cards")`
  - 암호화: `CryptoJS.AES` 사용, `VITE_CRYPTO_KEY`가 없으면 `"dev-only-key"` 기본값
  - 파생 표시값: 카드번호 마스킹(`**** **** p3 p4`), `last4`, `cvcLength` 생성 후 저장
  - 구성 컴포넌트:
    - `CardRegistrationForm`: 카드 등록 폼(이름/번호/유효기간/CVC/비밀번호 앞 2자리)
      - 세부 입력 컴포넌트: `CardNumberInput`, `CardExpiryInput`, `CardHolderInput`, `CardSecurityCodeInput`, `CardPasswordInput`
    - `CardList`: 저장된 카드 목록 및 선택
    - `PurchaseButton`: 결제 버튼(카드 없거나 처리 중이면 비활성)
  - 흐름:
    - 등록 시 평문 입력 → 파생값 생성 → 민감정보 암호화 → 로컬 스토리지 저장
    - 카드 선택 후 “결제하기” 클릭 시 가상 결제 흐름(`setTimeout`)으로 완료 알림

**정책/상수 참고**
- 배송 정책 상수: **FREE_SHIPPING_THRESHOLD = 50,000원**, **SHIPPING_FLAT_FEE = 3,000원**
- 결제 카드 암호화 키 사용 방식 불일치: `PaymentPage`는 `VITE_CRYPTO_KEY`(환경변수)를 사용, `CardList`는 하드코딩된 `'my-secret-key'`를 사용. 운영 전 일치화 필요.

---

### 컴포넌트( Components )
- **`src/components/Header.tsx`**
  - Prop: `cartCount`
  - 기능: 상단 고정 헤더, 장바구니 아이콘 배지 및 `/cart` 링크

- **상품 영역**
  - **`src/components/ProductList.tsx`**: 상품 목록 컨테이너(샘플/데모 용도로 `ProductListPage`와 유사 역할)
  - **`src/components/ProductCard.tsx`**
    - Props: `product`, `onAddToCart`
    - State: `added`(중복 담기 방지/버튼 라벨 토글)
    - 동작: 담기 버튼 클릭 → `onAddToCart()` → 버튼 상태 “담김”

- **결제 하위 컴포넌트(`src/components/payment/*`)**
  - `CardRegistrationForm.tsx`: 등록 폼(입력 컴포넌트 합성, 제출 시 상위로 `onRegister(card)` 콜백)
  - 입력 컴포넌트 5종: `CardNumberInput.tsx`, `CardExpiryInput.tsx`, `CardHolderInput.tsx`, `CardSecurityCodeInput.tsx`, `CardPasswordInput.tsx`
  - `CardList.tsx`: 카드 목록 표시/선택(라디오/리스트 UI)
  - `PurchaseButton.tsx`: 상태에 따른 레이블/비활성 처리 및 클릭 핸들러 호출
  - `FlippableCard.tsx`(+ `FlippableCard.css`): 카드 시각 효과(미리보기/애니메이션 용)

---

### 데이터 및 스토리북
- **데이터**
  - `src/data/products.ts`: `Product` 타입과 더미 데이터(이미지/가격/설명)
  - `src/data/cards.ts`: `Card` 타입 선언
- **스토리북 샘플(`src/stories/*`)**
  - `Button.stories.ts`, `Header.stories.ts`, `Page.stories.ts` 등 샘플 스토리/컴포넌트 포함(프로젝트 컴포넌트와는 별개)

---

### 라우팅 경로 요약
- `/`
- `/cart`
- `/payment`
- `/products/:id`
